<!doctype html><html lang=zh>
<head>
<title>Go é”™è¯¯å¤„ç† | Blog</title><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Go è¯­è¨€å¦‚ä½•è¡¨ç¤ºé”™è¯¯ ğŸ”—å†…ç½®æ¥å£ ğŸ”—Go è¯­è¨€å†…ç½®äº†ä¸€ä¸ªæ¥å£ç±»å‹ error
type error interface {  Error() string } æ‰€æœ‰å®ç°äº† error æ¥å£çš„ç±»å‹è¢«ç§°ä¸ºé”™è¯¯ç±»å‹(Error Type)
é”™è¯¯ç±»å‹çš„å€¼è¡¨ç¤ºä¸€ä¸ªé”™è¯¯çš„å‘ç”Ÿ
error æ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• Error()ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨æ¥æè¿°é”™è¯¯ä¿¡æ¯
æ³¨æ„ï¼šError() æ–¹æ³•æ˜¯ä¸ºäººç±»è®¾è®¡çš„ï¼Œè€Œéä»£ç 
Error() è¿”å›çš„é”™è¯¯ä¿¡æ¯åªåº”è¯¥è¢«å­˜å‚¨åœ¨æ—¥å¿—ä¸­ï¼Œæˆ–æ˜¯è¢«æ‰“å°åˆ°å±å¹•ä¸Šï¼Œç”¨äºäººç±»æŸ¥çœ‹ï¼Œç»ä¸èƒ½åœ¨ä»£ç ä¸­æ£€æŸ¥è¯¥é”™è¯¯ä¿¡æ¯ï¼Œä¾èµ–äºè¯¥é”™è¯¯ä¿¡æ¯å†³å®šç¨‹åºçš„æ‰§è¡Œé€»è¾‘
ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸å¥½çš„
func main() {  content, err := os.ReadFile(&#34;example.txt&#34;)  errInfo := err.Error()  switch errInfo {  case &#34;open example.txt: no such file or directory&#34;:  // handling error: create file  case &#34;open example.txt: permission denied&#34;:  // handling error: modify permission  } } errors åŒ…ä¸­çš„é”™è¯¯ç±»å‹ ğŸ”—Go è¯­è¨€åœ¨æ ‡å‡†åº“çš„ errors åŒ…ä¸­å®šä¹‰äº†ä¸€ä¸ªéå¸¸ç®€å•çš„é”™è¯¯ç±»å‹">
<meta name=generator content="Hugo 0.93.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/css/style.css>
<link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon>
</head><body>
<nav class=navigation>
<a href=/> <span class=arrow>â†</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
</nav><main class=main>
<section id=single>
<h1 class=title>Go é”™è¯¯å¤„ç†</h1><div class=tip>
<time datetime="2022-02-24 13:38:28 +0800 +0800">Feb 24, 2022</time>
<span class=split>
Â·
</span>
<span>
1441 words
</span>
<span class=split>
Â·
</span>
<span>
7 minute read
</span>
</div><aside class=toc>
<details>
<summary>Table of Contents
</summary>
<div>
<nav id=TableOfContents>
<ul>
<li><a href=#go-è¯­è¨€å¦‚ä½•è¡¨ç¤ºé”™è¯¯>Go è¯­è¨€å¦‚ä½•è¡¨ç¤ºé”™è¯¯</a>
<ul>
<li><a href=#å†…ç½®æ¥å£>å†…ç½®æ¥å£</a></li><li><a href=#errors-åŒ…ä¸­çš„é”™è¯¯ç±»å‹>errors åŒ…ä¸­çš„é”™è¯¯ç±»å‹</a></li><li><a href=#è‡ªå®šä¹‰é”™è¯¯ç±»å‹>è‡ªå®šä¹‰é”™è¯¯ç±»å‹</a></li></ul></li><li><a href=#go-è¯­è¨€å¦‚ä½•æ£€æŸ¥é”™è¯¯>Go è¯­è¨€å¦‚ä½•æ£€æŸ¥é”™è¯¯</a></li><li><a href=#go-è¯­è¨€å¦‚ä½•åŒ…è£…é”™è¯¯>Go è¯­è¨€å¦‚ä½•åŒ…è£…é”™è¯¯</a>
<ul>
<li><a href=#githubcompkgerrors>github.com/pkg/errors</a></li><li><a href=#go113>Go1.13</a></li></ul></li><li><a href=#å¦‚ä½•è®¾è®¡é”™è¯¯å¤„ç†>å¦‚ä½•è®¾è®¡é”™è¯¯å¤„ç†</a>
<ul>
<li><a href=#sentinel-error>sentinel error</a></li><li><a href=#custom-error-type>custom error type</a></li><li><a href=#opaque-error>opaque error</a></li></ul></li><li><a href=#go-è¯­è¨€å¦‚ä½•å¤„ç†é”™è¯¯>Go è¯­è¨€å¦‚ä½•å¤„ç†é”™è¯¯</a></li><li><a href=#é”™è¯¯å¤„ç†æŠ€å·§>é”™è¯¯å¤„ç†æŠ€å·§</a></li><li><a href=#references>References</a></li></ul></nav></div></details>
</aside><div class=content>
<h1 id=go-è¯­è¨€å¦‚ä½•è¡¨ç¤ºé”™è¯¯>Go è¯­è¨€å¦‚ä½•è¡¨ç¤ºé”™è¯¯ <a href=#go-%e8%af%ad%e8%a8%80%e5%a6%82%e4%bd%95%e8%a1%a8%e7%a4%ba%e9%94%99%e8%af%af class=anchor>ğŸ”—</a></h1><h2 id=å†…ç½®æ¥å£>å†…ç½®æ¥å£ <a href=#%e5%86%85%e7%bd%ae%e6%8e%a5%e5%8f%a3 class=anchor>ğŸ”—</a></h2><p>Go è¯­è¨€å†…ç½®äº†ä¸€ä¸ªæ¥å£ç±»å‹ <code>error</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#66d9ef>error</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ‰€æœ‰å®ç°äº† <code>error</code> æ¥å£çš„ç±»å‹è¢«ç§°ä¸ºé”™è¯¯ç±»å‹(Error Type)</p><p>é”™è¯¯ç±»å‹çš„å€¼è¡¨ç¤ºä¸€ä¸ªé”™è¯¯çš„å‘ç”Ÿ</p><p><code>error</code> æ¥å£åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• <code>Error()</code>ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨æ¥æè¿°é”™è¯¯ä¿¡æ¯</p><p>æ³¨æ„ï¼š<code>Error()</code> æ–¹æ³•æ˜¯ä¸ºäººç±»è®¾è®¡çš„ï¼Œè€Œéä»£ç </p><p><code>Error()</code> è¿”å›çš„é”™è¯¯ä¿¡æ¯åªåº”è¯¥è¢«å­˜å‚¨åœ¨æ—¥å¿—ä¸­ï¼Œæˆ–æ˜¯è¢«æ‰“å°åˆ°å±å¹•ä¸Šï¼Œç”¨äºäººç±»æŸ¥çœ‹ï¼Œç»ä¸èƒ½åœ¨ä»£ç ä¸­æ£€æŸ¥è¯¥é”™è¯¯ä¿¡æ¯ï¼Œä¾èµ–äºè¯¥é”™è¯¯ä¿¡æ¯å†³å®šç¨‹åºçš„æ‰§è¡Œé€»è¾‘</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸å¥½çš„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#e6db74>&#34;example.txt&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>errInfo</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>errInfo</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;open example.txt: no such file or directory&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handling error: create file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;open example.txt: permission denied&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handling error: modify permission
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=errors-åŒ…ä¸­çš„é”™è¯¯ç±»å‹>errors åŒ…ä¸­çš„é”™è¯¯ç±»å‹ <a href=#errors-%e5%8c%85%e4%b8%ad%e7%9a%84%e9%94%99%e8%af%af%e7%b1%bb%e5%9e%8b class=anchor>ğŸ”—</a></h2><p>Go è¯­è¨€åœ¨æ ‡å‡†åº“çš„ <code>errors</code> åŒ…ä¸­å®šä¹‰äº†ä¸€ä¸ªéå¸¸ç®€å•çš„é”™è¯¯ç±»å‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>errorString</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>errorString</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ç”±äº <code>errorString</code> ä¸æ˜¯å¯¼å‡ºçš„ï¼Œ<code>errors</code> åŒ…åŒæ—¶å®ç°äº†ä¸€ä¸ª <code>New()</code> å‡½æ•°ç”¨äºåˆ›å»ºè¯¥é”™è¯¯ç±»å‹çš„å€¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// New returns an error that formats as the given text.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Each call to New returns a distinct error value even if the text is identical.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>text</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>errorString</span>{<span style=color:#a6e22e>text</span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæ›´åŠ è¯­ä¹‰åŒ–ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºé”™è¯¯æ—¶ä½¿ç”¨ <code>errors.New("some error")</code> è¦æ¯” <code>&ErrorString{"some error"}</code> çœ‹èµ·æ¥æ›´æœ‰è¯­ä¹‰</p><p>ç¬¬äºŒç‚¹æ˜¯é˜²æ­¢å‡ºé”™ï¼Œä¾‹å¦‚ä¸å°å¿ƒä½¿ç”¨ <code>ErrorString{"some error"}</code>ï¼Œå› ä¸º <code>*errorString</code> ç±»å‹æ‰å®ç°äº† <code>Error()</code> æ–¹æ³•ï¼Œ<code>errorString</code> ç±»å‹å¹¶æ²¡æœ‰å®ç°</p><p>é‚£ä¸ºä»€ä¹ˆä¸è¿™æ ·å®šä¹‰ <code>errorString</code> é”™è¯¯ç±»å‹å‘¢</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>errorString</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>errorString</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æˆ–è€…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>errorString</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>errorString</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦‚æœè¿™æ ·å®šä¹‰çš„è¯ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å†…å®¹ç›¸åŒçš„ <code>error</code> æ—¶ï¼Œè¿™ä¸¤ä¸ª <code>error</code> çš„æ˜¯ç›¸ç­‰çš„</p><p>è¿™æ ·å› ä¸º Go è¯­è¨€å¯¹ <code>struct</code> çš„ <code>==</code> æ¯”è¾ƒä¼šæ¯”è¾ƒå…¶å†…éƒ¨çš„å„ä¸ªå­—æ®µ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>errorString</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>errorString</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errorString</span>{<span style=color:#e6db74>&#34;some error&#34;</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errorString</span>{<span style=color:#e6db74>&#34;some error&#34;</span>}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>err2</span>) <span style=color:#75715e>// true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>ä¸‹é¢çš„ä»£ç åŒç†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>errorString</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>errorString</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errorString</span>(<span style=color:#e6db74>&#34;some error&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errorString</span>(<span style=color:#e6db74>&#34;some error&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>err2</span>) <span style=color:#75715e>// true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>ä½†æ˜¯ <code>errorString</code> çš„è®¾è®¡å¹¶ä¸å¸Œæœ›è¿™æ ·ï¼Œå®ƒå¸Œæœ›çš„æ˜¯æ¯ä¸€ä¸ªå€¼éƒ½æ˜¯ä¸åŒçš„ï¼Œæ³¨æ„ <code>New()</code> å‡½æ•°ä¸Šé¢çš„æ³¨é‡Šï¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;some error&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;some error&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>err2</span>) <span style=color:#75715e>// false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><blockquote>
<p>ä¸‹é¢ä¼šè®²åˆ°ï¼Œæ ‡å‡†åº“é‡Œä½¿ç”¨ä¼—å¤šçš„ä¸€ä¸ª Go é”™è¯¯å¤„ç†çš„è®¾è®¡æ¨¡å¼ sentinel errorï¼Œå°±ä¾èµ–è¯¥ç‰¹æ€§</p></blockquote><p><code>fmt</code> åŒ…è¿˜æœ‰ä¸€ä¸ª <code>Errorf</code> å‡½æ•°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// go1.13 ä¹‹å‰
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Errorf</span>(<span style=color:#a6e22e>format</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>a</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>Sprintf</span>(<span style=color:#a6e22e>format</span>, <span style=color:#a6e22e>a</span><span style=color:#f92672>...</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™ä¸ªå‡½æ•°æ›´æ–¹ä¾¿ä¸€ç‚¹ï¼Œå…ˆæ ¼å¼åŒ–åï¼Œå†è°ƒç”¨ <code>errors.New()</code></p><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯èƒ½å‘ç”Ÿé”™è¯¯çš„å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>errors.New()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Sqrt</span>(<span style=color:#a6e22e>f</span> <span style=color:#66d9ef>float64</span>) (<span style=color:#66d9ef>float64</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>f</span> &lt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;math: square root of negative number&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>æŠ›å‡ºé”™è¯¯æ–¹è¿˜åº”è¯¥åŒ…å«å°½å¯èƒ½å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>os.ReadFile()</code> çš„ <code>Error()</code> æ–¹æ³•ä¼šè¿”å› <code>open example.txt: permission denied</code>ï¼Œè€Œä¸åªæ˜¯ <code>permission denied</code></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>fmt.Errorf()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>f</span> &lt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;math: square root of negative number %g&#34;</span>, <span style=color:#a6e22e>f</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=è‡ªå®šä¹‰é”™è¯¯ç±»å‹>è‡ªå®šä¹‰é”™è¯¯ç±»å‹ <a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e7%b1%bb%e5%9e%8b class=anchor>ğŸ”—</a></h2><p>ä½¿ç”¨ <code>errors.New()</code> æˆ– <code>fmt.Errorf()</code> åˆ›å»º <code>errors.errorString</code> ç±»å‹å·²ç»åŠæ ¼äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥åšçš„æ›´å¥½</p><p>åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå·±çš„é”™è¯¯ç±»å‹ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ª <code>struct</code>ï¼Œé‡Œé¢æ˜¯å’Œä¸šåŠ¡ç›¸å…³çš„å­—æ®µï¼Œä¾‹å¦‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ParseError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Msg</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>File</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Line</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ParseError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s:%d: %s&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>File</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Line</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Msg</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parse</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ParseError</span>{<span style=color:#e6db74>&#34;some error&#34;</span>, <span style=color:#e6db74>&#34;example.json&#34;</span>, <span style=color:#ae81ff>66</span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=go-è¯­è¨€å¦‚ä½•æ£€æŸ¥é”™è¯¯>Go è¯­è¨€å¦‚ä½•æ£€æŸ¥é”™è¯¯ <a href=#go-%e8%af%ad%e8%a8%80%e5%a6%82%e4%bd%95%e6%a3%80%e6%9f%a5%e9%94%99%e8%af%af class=anchor>ğŸ”—</a></h1><p>ä¸Šä¸€èŠ‚ä»‹ç»äº† Go è¯­è¨€å¦‚ä½•è¡¨ç¤ºé”™è¯¯ï¼Œæ ¸å¿ƒå°±ä¸‰å¥è¯ï¼š</p><ol>
<li>Go è¯­è¨€å†…ç½®äº†ä¸€ä¸ªæ¥å£ç±»å‹ <code>error</code></li><li>æ‰€æœ‰å®ç°äº† <code>error</code> æ¥å£çš„ç±»å‹è¢«ç§°ä¸ºé”™è¯¯ç±»å‹</li><li>é”™è¯¯ç±»å‹çš„å€¼è¡¨ç¤ºä¸€ä¸ªé”™è¯¯</li></ol><p>ç¨‹åºè¦å’Œå¤–ç•Œäº¤äº’ï¼Œå°±ä¼šä¸å¯é¿å…åœ°ä¼šå‡ºç°äº‹å…ˆé¢„çŸ¥çš„å¼‚å¸¸æƒ…å†µ</p><p>è¿™ä¸€èŠ‚è®²çš„æ˜¯ Go è®¾è®¡é”™è¯¯ä»¥åŠæ£€æŸ¥é”™è¯¯çš„å‡ ç§æ–¹å¼</p><p>æœ€ç®€å•çš„æ˜¯æ¯”è¾ƒ <code>err</code> æ˜¯å¦æ˜¯ <code>nil</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// something went wrong
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œè¿™ç§æ–¹æ³•æ˜¯å¾ˆå¥½çš„ï¼Œé”™è¯¯çš„ç»†èŠ‚å¯¹äºè°ƒç”¨è€…æ˜¯é€æ˜çš„</p><p>ä½†æ˜¯æœ‰äº› API å¯èƒ½å‘ç”Ÿå¤šç§é”™è¯¯ï¼Œé€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œè°ƒç”¨è€…ä¹Ÿåªèƒ½çŸ¥é“æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ï¼Œè€Œä¸èƒ½çŸ¥é“æ˜¯å“ªä¸€ç§é”™è¯¯</p><p>åœ¨æ ‡å‡†åº“ä¸­å¾ˆå¸¸è§çš„ä¸€ç§åšæ³•æ˜¯å®šä¹‰ sentinel error, å°†å¯èƒ½çš„é”™è¯¯å®šä¹‰ä¸ºä¸€äº›é”™è¯¯å€¼ï¼Œæ¯ä¸ªé”™è¯¯å€¼å¯¹åº”ä¸€ç§é”™è¯¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ErrNotFound</span> = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;not found&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>ErrNotFound</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// something wasn&#39;t found
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>ä½†æœ‰æ—¶è°ƒç”¨è€…è¿˜éœ€è¦çŸ¥é“æ›´å¤šçš„é”™è¯¯ä¿¡æ¯ï¼Œå› æ­¤è®¸å¤šåº“å®šä¹‰äº†è‡ªå·±çš„é”™è¯¯ç±»å‹å¹¶æš´éœ²å‡ºæ¥ï¼Œè®©è°ƒç”¨è€…ä½¿ç”¨æ¥å£æ–­è¨€æœºåˆ¶è·å–æ›´å¤šä¿¡æ¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>NotFoundError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>NotFoundError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: not found&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>NotFoundError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// e.Name wasn&#39;t found
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>ä¸Šé¢æ˜¯ 3 ç§è®¾è®¡å’Œæ£€æŸ¥é”™è¯¯çš„æ–¹å¼ï¼Œæ£€æŸ¥é”™è¯¯æ˜¯ä¸ºäº†æ›´å¥½åœ°å¤„ç†ï¼Œé”™è¯¯å¤„ç†ä¸€ä¸ªå¾ˆæ™®éçš„æ–¹å¼æ˜¯å‘ä¸Šä¼ é€’</p><p>å½“è°ƒç”¨ API å¾—åˆ° <code>err != nil</code> æ—¶ï¼Œè°ƒç”¨æ–¹å¯èƒ½å¹¶æ²¡æœ‰è´£ä»»å»å¤„ç†é”™è¯¯ï¼Œè€Œåº”è¯¥å°†é”™è¯¯ä¼ ç»™ä¸Šå±‚ï¼Œå¹¶ä¸”å¸Œæœ›æ·»åŠ å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;decompress %v: %v&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä½†æ˜¯ï¼Œè¿™ç§è¡Œä¸ºä¼šç ´åä»¥ä¸Šçš„æ‰€æœ‰çš„é”™è¯¯è®¾è®¡ï¼Œä¸è®ºæ˜¯ sentinel errorï¼Œè¿˜æ˜¯é”™è¯¯ç±»å‹</p><p>å› ä¸º <code>fmt.Errorf()</code> è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ <code>errorString</code> ç±»å‹çš„é”™è¯¯å€¼</p><p>æ›´ä¸Šå±‚çš„è°ƒç”¨è€…æ— æ³•ä½¿ç”¨è¯¥é”™è¯¯å€¼å’Œ sentinel error æ¯”è¾ƒï¼Œä¹Ÿæ— æ³•æ–­è¨€ä¸ºåº“å¯¼å‡ºçš„é”™è¯¯ç±»å‹</p><p><code>fmt.Errorf()</code> æŠ¹é™¤äº†åŸæœ‰é”™è¯¯çš„ä¸€åˆ‡ç±»å‹ä¿¡æ¯</p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åŒ…è£…é”™è¯¯ï¼Œ<code>fmt.Errorf()</code> æœ¬è´¨ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é”™è¯¯ï¼Œå¯¹åŸå§‹é”™è¯¯çš„ä¿ç•™ä»…ä»…æ˜¯ç»™äººç±»çœ‹çš„é”™è¯¯ä¿¡æ¯</p><p>é‚£æˆ‘ä»¬è‡ªå®šä¹‰é”™è¯¯ç±»å‹æ—¶ï¼Œå¯ä»¥ä¸“é—¨è®¾ç½®ä¸€ä¸ªå­—æ®µä¿å­˜åŸå§‹é”™è¯¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>QueryError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Query</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Err</span>   <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™ç§æ¨¡å¼å¾ˆå¿«æˆä¸ºåŒ…è£…é”™è¯¯äº‹å®ä¸Šçš„æ ‡å‡†</p><p>å½“æˆ‘ä»¬æ£€æŸ¥ sentinel error æ—¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>qerr</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>QueryError</span>); <span style=color:#a6e22e>ok</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>qerr</span>.<span style=color:#a6e22e>Err</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>ErrNotFound</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// do something
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å½“æˆ‘ä»¬æ£€æŸ¥é”™è¯¯ç±»å‹æ—¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>qerr</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>QueryError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>nerr</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>qerr</span>.<span style=color:#a6e22e>Err</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>NotFoundError</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// do something	with nerr.Name
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=go-è¯­è¨€å¦‚ä½•åŒ…è£…é”™è¯¯>Go è¯­è¨€å¦‚ä½•åŒ…è£…é”™è¯¯ <a href=#go-%e8%af%ad%e8%a8%80%e5%a6%82%e4%bd%95%e5%8c%85%e8%a3%85%e9%94%99%e8%af%af class=anchor>ğŸ”—</a></h1><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†åŒ…è£…é”™è¯¯çš„æ–¹æ³•ï¼Œä½†æ˜¯å…·ä½“è¿˜éœ€è¦å®ç°å¾ˆå¤šåŠŸèƒ½</p><p>ä¾‹å¦‚ï¼Œå¸Œæœ›åœ¨å½“å‰è°ƒç”¨çš„å±‚çº§æ·»åŠ è°ƒç”¨æ ˆä¿¡æ¯</p><p>æˆ–æ˜¯ï¼Œä¸Šé¢çš„æ£€æŸ¥é”™è¯¯å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½æ›´ç®€å•çš„æ£€æŸ¥é”™è¯¯</p><p><code>github.com/pkg/errors</code> å’Œ Go1.13 ç‰ˆæœ¬å¯¹æ ‡å‡†åº“çš„æ”¹è¿›å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜</p><h2 id=githubcompkgerrors>github.com/pkg/errors <a href=#githubcompkgerrors class=anchor>ğŸ”—</a></h2><p>å› ä¸º Go çš„é”™è¯¯å¤„ç†ä¾èµ–å¥‘çº¦è§„èŒƒ(é”™è¯¯ç±»å‹å¿…é¡»å®ç°çš„åªæ˜¯ä¸€ä¸ªä¸ºäººç±»è®¾è®¡çš„ <code>Error()</code> æ–¹æ³•ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–èƒ½åŠ›!)ï¼Œè€Œä¸åœ¨è¯­è¨€ç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶å±‚é¢ï¼Œ</p><p>å› æ­¤ Go è¯­è¨€ç»™äº†å¼€å‘è€…æå¤§çš„è‡ªç”±è‡ªå·±å»å®šä¹‰é”™è¯¯å¤„ç†çš„æ•´ä¸ªä½“ç³»</p><p>ç”±äº Go è¯­è¨€ errors åŒ…æä¾›çš„é”™è¯¯ç±»å‹å¤ªè¿‡ç®€é™‹ï¼Œä¸€äº›å¼€å‘è€…é€‰æ‹©è‡ªå·±å»å®šä¹‰é”™è¯¯ç±»å‹å’Œç›¸å…³çš„é”™è¯¯å¤„ç†æ–¹æ³•</p><p>æœ€æœ‰åçš„æ˜¯ github.com/pkg/errors åŒ…ï¼Œè¿™ä¸ªåŒ…å·²ç»æˆä¸º Go è¯­è¨€é”™è¯¯å¤„ç†çš„äº‹å®æ ‡å‡†ï¼Œè¯¥åŒ…ä¸»è¦å®ç°äº†é”™è¯¯é“¾ï¼ŒåŒ…è£…è°ƒç”¨æ ˆå’Œä¸Šä¸‹æ–‡ä¿¡æ¯ç­‰åŠŸèƒ½</p><p>pkg/errors åŒ…å®šä¹‰äº†ä¸‰ä¸ªé”™è¯¯ç±»å‹ <code>fundamental</code>, <code>withMessage</code>, <code>withStack</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>fundamental</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>*</span><span style=color:#a6e22e>stack</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>f</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>fundamental</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>msg</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>withMessage</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cause</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>msg</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>withMessage</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>msg</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>cause</span>.<span style=color:#a6e22e>Error</span>() }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>withMessage</span>) <span style=color:#a6e22e>Cause</span>() <span style=color:#66d9ef>error</span>  { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>cause</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>withStack</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>*</span><span style=color:#a6e22e>stack</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>withStack</span>) <span style=color:#a6e22e>Cause</span>() <span style=color:#66d9ef>error</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>w</span>.<span style=color:#66d9ef>error</span> }
</span></span></code></pre></div><p>è¿™äº›é”™è¯¯ç±»å‹æœ‰ä¸€ä¸ªå…±åŒç‚¹å°±æ˜¯éƒ½æœ‰ä¸€ä¸ª <code>cause</code> å­—æ®µ, æ¥ä¿å­˜åº•å±‚çš„é”™è¯¯ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ª <code>Cause()</code> æ–¹æ³•è¿”å› <code>cause</code> å­—æ®µ</p><p>è¿™æ ·å°±å¯ä»¥å®ç°ä¸€ä¸ª <code>Cause()</code> å‡½æ•°ï¼Œæ²¿ç€ cause å­—æ®µæ„æˆçš„é”™è¯¯é“¾ï¼Œä¸€åªæ‰¾åˆ°æœ€åº•å±‚çš„é‚£ä¸ªæ²¡æœ‰å®ç° <code>Cause()</code> æ–¹æ³•çš„åŸå§‹é”™è¯¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Cause</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>causer</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Cause</span>() <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cause</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#a6e22e>causer</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>cause</span>.<span style=color:#a6e22e>Cause</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>pkg/errors å®ç°äº†ä¸€äº›å‡½æ•°æ¥åˆ›å»ºé”™è¯¯æˆ–åŒ…è£…é”™è¯¯ï¼Œä»£ç éƒ½å¾ˆç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>fundamental</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>:   <span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>stack</span>: <span style=color:#a6e22e>callers</span>(),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Errorf</span>(<span style=color:#a6e22e>format</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>fundamental</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>:   <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#a6e22e>format</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>stack</span>: <span style=color:#a6e22e>callers</span>(),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WithMessage</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withMessage</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cause</span>: <span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>:   <span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WithMessagef</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>format</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withMessage</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cause</span>: <span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>:   <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#a6e22e>format</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WithStack</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withStack</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>callers</span>(),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Wrap</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withMessage</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cause</span>: <span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>:   <span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withStack</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>callers</span>(),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Wrapf</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>format</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withMessage</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cause</span>: <span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>:   <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#a6e22e>format</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>withStack</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>callers</span>(),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯</p><ul>
<li>New/Errorf
<ul>
<li>åˆ›å»ºé”™è¯¯</li><li>æ–°çš„é”™è¯¯æ˜¯ <code>fundamental</code> ç±»å‹</li><li>å¸¦æœ‰ call stack ä¿¡æ¯</li></ul></li><li>WithMessage/WithMessagef
<ul>
<li>åŒ…è£…é”™è¯¯</li><li>æ–°çš„é”™è¯¯æ˜¯ <code>withMessage</code> ç±»å‹</li><li>å¢æ·»äº†ä¸Šä¸‹æ–‡ä¿¡æ¯</li></ul></li><li>WithStack
<ul>
<li>åŒ…è£…é”™è¯¯</li><li>æ–°çš„é”™è¯¯æ˜¯ <code>withStack</code> ç±»å‹</li><li>å¢æ·»äº† call stack ä¿¡æ¯</li></ul></li><li>Wrap/Wrapf
<ul>
<li>åŒ…è£…é”™è¯¯</li><li>å…ˆè°ƒç”¨ <code>withMessage</code>ï¼Œå†è°ƒç”¨ <code>withStack</code></li><li>å¢æ·»äº† call stack ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ä¿¡æ¯</li></ul></li></ul><h2 id=go113>Go1.13 <a href=#go113 class=anchor>ğŸ”—</a></h2><p>åœ¨è¿‡å» Go è¯­è¨€é”™è¯¯å¤„ç†æ–¹é¢çš„å®è·µä¸­ï¼Œè‡ªå®šä¹‰é”™è¯¯ç±»å‹ä½¿ç”¨ä¸€ä¸ªå­—æ®µæ¥æŒ‡å‘åº•å±‚é”™è¯¯çš„åšæ³•å·²ç»éå¸¸æ™®é</p><p>ä¸ç®¡æ˜¯ä¸Šé¢é€šç”¨ç›®çš„çš„ <code>fundamental</code>, <code>withMessage</code>, <code>withStack</code>ï¼Œè¿˜æ˜¯ä¸€äº›é¢å‘ç‰¹å®šåœºæ™¯çš„é”™è¯¯ç±»å‹ï¼Œä¾‹å¦‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>QueryError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Query</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Err</span>   <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>QueryError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Query</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Err</span>.<span style=color:#a6e22e>Error</span>() }
</span></span></code></pre></div><p>å› æ­¤ Go åœ¨ 1.13 ç‰ˆæœ¬å¢åŠ äº†å¯¹è¿™ç§æ¨¡å¼çš„æ”¯æŒï¼Œä¸»è¦æ˜¯ä¸º errors åŒ…æ·»åŠ äº†ä»¥ä¸‹ä¸‰ä¸ªå‡½æ•°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Unwrap</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) <span style=color:#66d9ef>error</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>target</span> <span style=color:#66d9ef>error</span>) <span style=color:#66d9ef>bool</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>As</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>target</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>bool</span> {}
</span></span></code></pre></div><p>åŒæ—¶ä¿®æ”¹äº† <code>fmt.Errorf()</code> çš„å®ç°</p><h1 id=å¦‚ä½•è®¾è®¡é”™è¯¯å¤„ç†>å¦‚ä½•è®¾è®¡é”™è¯¯å¤„ç† <a href=#%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e9%94%99%e8%af%af%e5%a4%84%e7%90%86 class=anchor>ğŸ”—</a></h1><p>Go è¯­è¨€çš„é”™è¯¯å¤„ç†æœ‰ä¸‹é¢ä¸‰ç§è®¾è®¡æ¨¡å¼ï¼š</p><ol>
<li>sentinel error</li><li>custom error type</li><li>opaque error</li></ol><h2 id=sentinel-error>sentinel error <a href=#sentinel-error class=anchor>ğŸ”—</a></h2><h2 id=custom-error-type>custom error type <a href=#custom-error-type class=anchor>ğŸ”—</a></h2><h2 id=opaque-error>opaque error <a href=#opaque-error class=anchor>ğŸ”—</a></h2><h1 id=go-è¯­è¨€å¦‚ä½•å¤„ç†é”™è¯¯>Go è¯­è¨€å¦‚ä½•å¤„ç†é”™è¯¯ <a href=#go-%e8%af%ad%e8%a8%80%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86%e9%94%99%e8%af%af class=anchor>ğŸ”—</a></h1><p>è¿™ä¸€èŠ‚å°†ä»‹ç»å¤„ç†é”™è¯¯çš„æ–¹æ³•å’ŒåŸåˆ™</p><p>é¦–å…ˆï¼Œé”™è¯¯å¤„ç†æœ‰ä¸€æ¡é€šç”¨çš„åŸåˆ™ï¼šå¯¹äºé”™è¯¯ï¼Œè¦ä¹ˆä¸å¤„ç†ï¼Œè¦ä¹ˆå®Œå…¨å¤„ç†</p><p>æˆ‘ä¸çŸ¥é“æ€ä¹ˆåšï¼Œä¸å¤„ç†ï¼Œç›´æ¥å°†é”™è¯¯ä¼ ç»™ä¸Šå±‚, å¦‚ä¸‹ç¤ºä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>readFile</span>(<span style=color:#e6db74>&#34;example.txt&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readFile</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>path</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>content</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æˆ‘çŸ¥é“æ€ä¹ˆåšï¼Œå®Œå…¨å¤„ç†å¥½ï¼Œå±è”½æ‰åº•å±‚é”™è¯¯ï¼Œå¦‚ä¸‹ç¤ºä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>content</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>readFile</span>(<span style=color:#e6db74>&#34;example.txt&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readFile</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>path</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;default text&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>content</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ€»ä¹‹ä¸€å®šè¦æ¸…æ¥šè‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œä¸è¦åˆå¤„ç†ä¸€éƒ¨åˆ†ï¼Œåˆè¦æŠ›ç»™ä¸Šå±‚</p><blockquote>
<p>Don&rsquo;t just check errors, handle them gracefully.</p></blockquote><p>æœ€å¸¸è§çš„åœºæ™¯æ˜¯è®°å½•æ—¥å¿—ï¼Œå› ä¸ºè®°å½•æ—¥å¿—æœ¬èº«ä¹Ÿæ˜¯å¤„ç†é”™è¯¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readFile</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>content</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>path</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>content</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>é”™è¯¯å¤„ç†ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©</p><ol>
<li>ç›´æ¥å°†é”™è¯¯å‘ä¸Šä¼ ï¼Œå³ç›´æ¥ return err</li><li>åŒ…è£…å½“å‰é”™è¯¯ï¼Œæ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯, å†å‘ä¸Šä¼ </li><li>å±è”½æ‰åº•å±‚é”™è¯¯, è¿”å›è‡ªå·±å®šä¹‰çš„é”™è¯¯</li><li>å¤„ç†é”™è¯¯ï¼Œä¸è¿”å›é”™è¯¯</li></ol><p>å¯¹äºåº”ç”¨æ¥è¯´ï¼Œä¸éœ€è¦å®šä¹‰è‡ªå·±çš„é”™è¯¯ç±»å‹ï¼Œä½¿ç”¨ github.com/pkg/errors åŒ…</p><p>å¯ä»¥æŠŠåº”ç”¨çš„è°ƒç”¨é“¾æŠ½è±¡ä¸º layer1 -> layer2 -> layer3 -> lib</p><p>layer3 å°±æ˜¯è°ƒç”¨ API çš„åœ°æ–¹ï¼Œå³åº”ç”¨çš„è¾¹ç•Œï¼Œå¯¹äº lib è¿”å›çš„ errorï¼Œä½¿ç”¨ WithStack/Wrap/Wrapf åŒ…è£…, è¿™é‡Œçš„é‡ç‚¹æ˜¯å¸¦ä¸Šè°ƒç”¨æ ˆä¿¡æ¯</p><p>layer2 ç›´æ¥è¿”å› layer3 çš„ errorï¼Œæˆ–è€…ä½¿ç”¨ WithMessage/WithMessagef åŒ…è£…ï¼Œæˆ–è€…ç›´æ¥å¤„ç†å¥½ï¼Œä¸è¿”å› error</p><p>layer1 æ˜¯æœ€ä¸Šå±‚äº†ï¼Œåªèƒ½æŠŠ error å¤„ç†å¥½ï¼Œæ—¥å¿—è®°å½•å°±åœ¨è¿™é‡Œ</p><p>å¯¹äºåº“æ¥è¯´ï¼Œè¦ä½¿ç”¨ä¸Šé¢è®²çš„ opaque error è®¾è®¡</p><h1 id=é”™è¯¯å¤„ç†æŠ€å·§>é”™è¯¯å¤„ç†æŠ€å·§ <a href=#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e6%8a%80%e5%b7%a7 class=anchor>ğŸ”—</a></h1><p>é•¿ä¹…ä»¥æ¥ï¼Œå¯¹äº Go è¯­è¨€çš„ä¸€ç§æ‰¹è¯„å°±æ˜¯"é”™è¯¯å¤„ç†å¤ªç¹çäº†ï¼Œè¦åœ¨ä»£ç é‡Œå†™éå¸¸å¤šçš„ <code>if err != nil</code>"</p><p>ä½†è¿™å¯èƒ½æ˜¯ä¹ æƒ¯äº <code>try...catch</code> çš„ç¨‹åºå‘˜å¹¶æ²¡æœ‰å‘æŒ¥ Go è¯­è¨€é”™è¯¯å¤„ç†çš„èƒ½åŠ›</p><p>ä»–ä»¬æŠŠ <code>if err != nil</code> å½“ä½œä¸€ä¸ªå®šå¼ï¼Œåƒ <code>try...catch</code> é‚£æ ·, è€Œå¿½ç•¥äº† Go è¯­è¨€é”™è¯¯å¤„ç†çš„æœ¬è´¨ï¼Œå³ Errors are value</p><p>å› æ­¤ï¼Œé”™è¯¯åœ¨ç¼–ç¨‹ä¸­æ˜¯éå¸¸çµæ´»çš„</p><blockquote>
<p>Values can be programmed, and since errors are values, errors can be programmed.</p></blockquote><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Point</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p</span> <span style=color:#a6e22e>Point</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Longitude</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Latitude</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Distance</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>ElevationGain</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>ElevationLoss</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é—­åŒ…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Point</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p</span> <span style=color:#a6e22e>Point</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>read</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Longitude</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Latitude</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Distance</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>ElevationGain</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>ElevationLoss</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Reader</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Reader</span>) <span style=color:#a6e22e>read</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>input</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Point</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>p</span> <span style=color:#a6e22e>Point</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Reader</span>{<span style=color:#a6e22e>r</span>: <span style=color:#a6e22e>input</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Longitude</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Latitude</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Distance</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>ElevationGain</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>read</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>ElevationLoss</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>p</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°æµå¼ API</p><p>å®é™…ä¸Šï¼Œ<code>bufio</code> åŒ…ä¸­çš„ <code>Scanner</code> å°±æ˜¯è¿™ä¹ˆåšçš„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>input</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>token</span> = <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>()
</span></span><span style=display:flex><span>  <span style=color:#75715e>// process token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Err</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// process error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h1 id=references>References <a href=#references class=anchor>ğŸ”—</a></h1><ul>
<li><a href=https://go-proverbs.github.io/ target=_blank rel=noopener>https://go-proverbs.github.io/</a></li><li><a href=https://go.dev/blog/error-handling-and-go target=_blank rel=noopener>https://go.dev/blog/error-handling-and-go</a></li><li><a href=https://go.dev/blog/errors-are-values target=_blank rel=noopener>https://go.dev/blog/errors-are-values</a> ğŸŒŸ</li><li><a href=https://go.dev/blog/go1.13-errors target=_blank rel=noopener>https://go.dev/blog/go1.13-errors</a> ğŸŒŸ</li><li><a href=https://dave.cheney.net/2014/12/24/inspecting-errors target=_blank rel=noopener>https://dave.cheney.net/2014/12/24/inspecting-errors</a></li><li><a href=https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully target=_blank rel=noopener>https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully</a> ğŸŒŸ</li><li><a href=https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package target=_blank rel=noopener>https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package</a></li><li><a href=https://dave.cheney.net/2019/01/27/eliminate-error-handling-by-eliminating-errors target=_blank rel=noopener>https://dave.cheney.net/2019/01/27/eliminate-error-handling-by-eliminating-errors</a></li><li><a href=https://crawshaw.io/blog/xerrors target=_blank rel=noopener>https://crawshaw.io/blog/xerrors</a></li><li><a href=https://www.ardanlabs.com/blog/2014/10/error-handling-in-go-part-i.html target=_blank rel=noopener>https://www.ardanlabs.com/blog/2014/10/error-handling-in-go-part-i.html</a></li><li><a href=https://www.ardanlabs.com/blog/2014/11/error-handling-in-go-part-ii.html target=_blank rel=noopener>https://www.ardanlabs.com/blog/2014/11/error-handling-in-go-part-ii.html</a></li><li><a href=https://www.ardanlabs.com/blog/2017/05/design-philosophy-on-logging.html target=_blank rel=noopener>https://www.ardanlabs.com/blog/2017/05/design-philosophy-on-logging.html</a></li><li><a href=https://medium.com/gett-engineering/error-handling-in-go-53b8a7112d04 target=_blank rel=noopener>https://medium.com/gett-engineering/error-handling-in-go-53b8a7112d04</a></li><li><a href=https://medium.com/gett-engineering/error-handling-in-go-1-13-5ee6d1e0a55c target=_blank rel=noopener>https://medium.com/gett-engineering/error-handling-in-go-1-13-5ee6d1e0a55c</a></li><li><a href=https://pkg.go.dev/golang.org/x/xerrors target=_blank rel=noopener>https://pkg.go.dev/golang.org/x/xerrors</a></li><li><a href=https://pkg.go.dev/github.com/pkg/errors target=_blank rel=noopener>https://pkg.go.dev/github.com/pkg/errors</a></li><li><a href=https://pkg.go.dev/errors@go1.17.7 target=_blank rel=noopener>https://pkg.go.dev/errors@go1.17.7</a></li></ul></div><div class=tags>
<a href=https://xtyi.github.io/tags/go>go</a>
</div></section></main><footer id=footer>
<div id=social>
<a class=symbol href=https://github.com/xtyi rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg>
</a>
</div><div class=copyright>
Â© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg>
</span>
</div><div class=powerby>
Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://https://github.com/nodejh/hugo-theme-mini>nodejh</a>
</div></footer></body></html>