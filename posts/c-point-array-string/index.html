<!doctype html><html lang=zh>
<head>
<title>C 语言的指针、数组和字符串 | Blog</title><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="前言 🔗C 语言中单论指针是比较简单的，但是和数组，字符串放在一起就会令人困惑
但其实 C 语言的一致性几乎是编程语言中最好的，对这些语法困惑的原因是没理解语法背后的实质
数组 🔗很多人都认为数组名是数组首元素的地址，大学里很多老师也是这么教的
这种说法是很滑稽的，数组名就是一个符号，代表数组而已
a[1] = 1; // 这里数组名代表数组首元素地址吗？ int arr[5]; printf(&#34;%d&#34;, sizeof(arr)); // 输出 20，是指针的大小吗？ 提出这种说法的人大概是为了解释 “数组可以做很多指针操作”，但又总不能直接说 “数组就是指针” 吧
实质是什么呢？数组就是数组，指针就是指针，没什么关系，顺便说一句，[] 是指针操作符
pointer[1] 等价于 *(pointer + 1)
而数组为什么也能用 [] 操作符呢？
当某个地方需要一个值的时候，你写上了数组，但数组又不能运算，于是编译器就用数组首元素地址去运算了
使用 [] 操作符时便是这种情况，因此，你一直认为的数组操作实际上是指针操作，数组是由于这种特殊的机制而能使用 []
字符串 🔗字符串是存储在连续内存空间的以 &lsquo;\0&rsquo; 结尾的字符序列
因此可以用数组保存字符串
char str[] = &#34;Hello World&#34;; 访问字符串使用首个字符的地址
printf(&#34;%d&#34;, str[1]); // 相当于 printf(&#34;%d&#34;, *(str + 1)); 字符串字面量是用一对双引号括起来的字符序列
&#34;Hello World&#34; 当多个字符串字面量相邻时，编译器会把它们合并成一个字符串
printf(&#34;Hello&#34;  &#34; World&#34;); 编译器会将字符串字面量看作 char * 类型的值，printf() 函数的第一个参数就是一个 char * 类型的指针">
<meta name=generator content="Hugo 0.93.2">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/css/style.css>
<link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon>
</head><body>
<nav class=navigation>
<a href=/> <span class=arrow>←</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
</nav><main class=main>
<section id=single>
<h1 class=title>C 语言的指针、数组和字符串</h1><div class=tip>
<time datetime="2017-01-23 13:38:28 +0800 +0800">Jan 23, 2017</time>
<span class=split>
·
</span>
<span>
146 words
</span>
<span class=split>
·
</span>
<span>
1 minute read
</span>
</div><aside class=toc>
<details>
<summary>Table of Contents
</summary>
<div>
<nav id=TableOfContents>
<ul>
<li><a href=#前言>前言</a></li><li><a href=#数组>数组</a></li><li><a href=#字符串>字符串</a></li></ul></nav></div></details>
</aside><div class=content>
<h1 id=前言>前言 <a href=#%e5%89%8d%e8%a8%80 class=anchor>🔗</a></h1><p>C 语言中单论指针是比较简单的，但是和数组，字符串放在一起就会令人困惑</p><p>但其实 C 语言的一致性几乎是编程语言中最好的，对这些语法困惑的原因是没理解语法背后的实质</p><h1 id=数组>数组 <a href=#%e6%95%b0%e7%bb%84 class=anchor>🔗</a></h1><p>很多人都认为数组名是数组首元素的地址，大学里很多老师也是这么教的</p><p>这种说法是很滑稽的，数组名就是一个符号，代表数组而已</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>a[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 这里数组名代表数组首元素地址吗？
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> arr[<span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span>printf(<span style=color:#e6db74>&#34;%d&#34;</span>, <span style=color:#66d9ef>sizeof</span>(arr)); <span style=color:#75715e>// 输出 20，是指针的大小吗？
</span></span></span></code></pre></div><p>提出这种说法的人大概是为了解释 “数组可以做很多指针操作”，但又总不能直接说 “数组就是指针” 吧</p><p>实质是什么呢？数组就是数组，指针就是指针，没什么关系，顺便说一句，<code>[]</code> 是指针操作符</p><p><code>pointer[1]</code> 等价于 <code>*(pointer + 1)</code></p><p>而数组为什么也能用 <code>[]</code> 操作符呢？</p><p>当某个地方需要一个值的时候，你写上了数组，但数组又不能运算，于是编译器就用数组首元素地址去运算了</p><p>使用 <code>[]</code> 操作符时便是这种情况，因此，你一直认为的数组操作实际上是指针操作，数组是由于这种特殊的机制而能使用 <code>[]</code></p><h1 id=字符串>字符串 <a href=#%e5%ad%97%e7%ac%a6%e4%b8%b2 class=anchor>🔗</a></h1><p>字符串是存储在连续内存空间的以 &lsquo;\0&rsquo; 结尾的字符序列</p><p>因此可以用数组保存字符串</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> str[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello World&#34;</span>;
</span></span></code></pre></div><p>访问字符串使用首个字符的地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>printf(<span style=color:#e6db74>&#34;%d&#34;</span>, str[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span><span style=color:#75715e>// 相当于
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>printf(<span style=color:#e6db74>&#34;%d&#34;</span>, <span style=color:#f92672>*</span>(str <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>));
</span></span></code></pre></div><p>字符串字面量是用一对双引号括起来的字符序列</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#e6db74>&#34;Hello World&#34;</span>
</span></span></code></pre></div><p>当多个字符串字面量相邻时，编译器会把它们合并成一个字符串</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>printf(<span style=color:#e6db74>&#34;Hello&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34; World&#34;</span>);
</span></span></code></pre></div><p>编译器会将字符串字面量看作 <code>char *</code> 类型的值，<code>printf()</code> 函数的第一个参数就是一个 <code>char *</code> 类型的指针</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>printf(<span style=color:#e6db74>&#34;Hello World&#34;</span>);
</span></span></code></pre></div><p>由于字符串字面量被看作 <code>char *</code> 类型的地址，因此可以有下面的操作</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;abc&#34;</span>;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> ch;
</span></span><span style=display:flex><span>ch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;abc&#34;</span>[<span style=color:#ae81ff>1</span>];
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#a6e22e>digit_to_hex_char</span>(<span style=color:#66d9ef>int</span> digit) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;0123456789ABCDEF&#34;</span>[digit];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>字符串字面量是存储在常量区的，因此试图改变字符串字面量会导致未定义的行为，通常会使程序崩溃</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;abc&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;def&#34;</span>; <span style=color:#75715e>// 会使程序崩溃
</span></span></span></code></pre></div><p>上面说的 &ldquo;编译器会将字符串字面量看作 <code>char *</code> 类型的值&rdquo;，其值就是在常量区的该字符串的首字符的地址</p><p>最后还有一点要说的，你有没有感觉什么不太对？</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> str[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Hello World&#34;</span>;
</span></span></code></pre></div><p>既然 <code>"Hello World"</code> 是 <code>char*</code> 类型，为什么还可以赋值给 <code>char[]</code> 类型啊？</p><p>其实这里的 <code>"Hello World"</code> 并不是字符串字面量，只是一个语法糖，等价于</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>char</span> str[] <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;H&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>, <span style=color:#e6db74>&#39;l&#39;</span>, <span style=color:#e6db74>&#39;l&#39;</span>, <span style=color:#e6db74>&#39;o&#39;</span>, <span style=color:#e6db74>&#39; &#39;</span>, <span style=color:#e6db74>&#39;W&#39;</span>, <span style=color:#e6db74>&#39;o&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#e6db74>&#39;l&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;\0&#39;</span>};
</span></span></code></pre></div><p>完</p></div><div class=tags>
<a href=https://xtyi.github.io/tags/c>c</a>
</div></section></main><footer id=footer>
<div id=social>
<a class=symbol href=https://github.com/xtyi rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg>
</a>
</div><div class=copyright>
© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg>
</span>
</div><div class=powerby>
Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://https://github.com/nodejh/hugo-theme-mini>nodejh</a>
</div></footer></body></html>